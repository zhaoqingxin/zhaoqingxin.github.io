<!DOCTYPE html>


<html id="-am-page" class="am-touch js cssanimations">
<head>
    <script id="allmobilize" charset="utf-8" src="http://a.yunshipei.com/eb9e513ee04a462913dcf5e87f4d49b0/allmobilize.min.js"></script>
    <meta http-equiv="Cache-Control" content="no-siteapp" />
    <meta http-equiv="Cache-Control" content="no-transform" />
    <link rel="alternate" media="handheld" href="#" />
    <meta http-equiv="Cache-Control" content="no-siteapp" />


</head>
<body class="index">
zhaoqingxin
<img src="//images/1.png" alt="">
<img src="//images/2.png" alt="">
<div>zhaoqingxin
<script type="text/javascript">
    var inputstr =  $("#arpinput");
    var d = dialog({
        title: '请进行ARP数据绑定',
        cancel: false,
        fixed:true,
        content: inputstr,
        id: 'EF893L',
        button:[
            {
                value:'提交',
                autofocus: true,
                callback:function(){
                    if(!checkDivInput()){
                        return false;
                    }else{
                        var username  = $("#username").val();
                        var password =$("#password").val();
                        initArpUserInfo(username,password);
                        return false;

                    }

                }
            }]
    });
    //判断通行证是否登录
    var session = "{role=[food_admin], arpunit=cn.arp.icas.lms.entity.TArpEmailUnitsView@281112cd, userinfo=cn.arp.icas.sys.entity.SysLoginView@5ca0e81, email=zyli@cnic.cn, token=cn.vlabs.umt.oauth.AccessToken@2b0d6675}";
    var passport = new Passport({umtUrl:'http://passport.escience.cn'});
    passport.checkLogin(function(flag){
        if(!flag){
            window.location.href="http://159.226.97.140/caslms/login.jsp";
        }else{
            if(session=="{}"){
                window.location.href="https://passport.escience.cn/oauth2/authorize?response_type=code&redirect_uri=http://159.226.97.140/caslms/sysLogin/sso&client_id=42668&theme=embed";
            }else{
                var userinfo = "cn.arp.icas.sys.entity.SysLoginView@5ca0e81";
                if(userinfo==""){
                    cleanDivInput();
                    d.showModal();
                    $("#tophello").html("数据未绑定");
                }else{
                    $("#tophello").html("您好，李镇阳");
                    $("#goback").html("<a  href='/caslms/foodnoticepublic/index' target='_blank'> 进入后台</a>");
                }
            }

        }
    });

    function cleanDivInput(){
        $("#username").val("");
        $("#password").val("");
    }

    function checkDivInput(){
        var result = true;
        $("#errorstr").html("")
        if($.trim($("#username").val())==""&&$.trim($("#password").val())==""){
            $("#errorstr").html("必须绑定ARP用户信息，才能正常使用系统");
            result = false
        }else if($.trim($("#password").val())==""){
            $("#errorstr").html("ARP密码不能为空");
            result = false
        }else if($.trim($("#username").val())==""){
            $("#errorstr").html("ARP用户名不能为空");
            result = false
        }
        return result;
    }

    function initArpUserInfo(username,password){
        $("button").attr("disabled","disabled");
        $.ajax({
            url: "/caslms/datebind/bind/",
            type: 'POST',
            dataType: 'json',
            data:{username:username,password:password}
        }).done(function(data, status, xhr) {
            if(data.id ==null){
                $("#errorstr").html("ARP用户名密码错误");
                $("button").removeAttr("disabled");
            }else{

                $("#tophello").html("您好，"+data.username+"<i></i>");
                d.close();
            }

        }).fail(function(xhr, status, error) {
            var error = xhr.responseJSON;
            $("#errorstr").html(error.code);
        });
    }
</script>
</body>
</html>

